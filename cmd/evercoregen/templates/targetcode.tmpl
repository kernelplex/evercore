// Code generated by evercore; DO NOT EDIT.
package {{.Config.OutputPkg}}

import (
	"fmt"
	"github.com/kernelplex/evercore/base"

	{{- range .UniqueImports}}
	"{{.}}"
	{{- end}}
)

const (
	{{- range $key, $value := .Aggregates}}
	{{$key}}Type = "{{$key}}"
	{{- end}}

	{{- range $key, $value := .StateEvents}}
	{{$key}}Type = "{{$key}}"
	{{- end}}

	{{- range $key, $value := .Events}}
	{{$key}}Type = "{{$key}}"
	{{- end}}
)

// Aggregates contains all aggregate types
var Aggregates = []string{
	{{- range $key, $value := .Aggregates}}
	"{{$key}}",
	{{- end}}
}

// Events contains all event types
var Events = []string{
	{{- range $key, $value := .Events}}
	"{{$key}}",
	{{- end}}
	{{- range $key, $value := .StateEvents}}
	"{{$key}}",
	{{- end}}
}

func EventDecoder(_ string, ev evercore.SerializedEvent) (evercore.EventState, error) {
	switch ev.EventType {

	{{- if .StateEvents}}

	// ================================================== 
	// State Events
	// ================================================== 

	{{- range $key, $value := .StateEvents}}
	case {{$key}}Type:
		eventState := {{$value.PackageName}}.{{$value.Struct}} {}
		err := evercore.DecodeEventStateTo(ev, &eventState)
		if err != nil {
			return nil, err
		}
		state := evercore.NewStateEvent(eventState)
		return state, nil
	{{- end}}
	{{- end}}
	{{- if .Events}}

	// ================================================== 
	// Other Events
	// ================================================== 
	
	{{range $key, $value := .Events}}
	case "{{$key}}":
		eventState := {{$value}}{}
		err := evercore.DecodeEventStateTo(ev, &eventState)
		if err != nil {
			return nil, err
		}
		state := evercore.NewStateEvent(eventState)
		return state, nil
	}
	{{- end}}
	{{- end}}
	}
	panic(fmt.Sprintf("Failed to decode event type: %s", ev.EventType))
}

